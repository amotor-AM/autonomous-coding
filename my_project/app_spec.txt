<project_specification>
  <project_name>Reprice Genius. An Agentic AI eBay Repricing Application</project_name>

  <builder_prompt>
BUILDER PROMPT — Design the Best Possible Agentic AI eBay Repricing Application (End-to-End)

You are an expert AI engineer + product architect + marketplace systems designer. Your task is to produce a complete, production-grade blueprint for building an agentic AI eBay repricing application from the ground up.

You MUST obey every requirement in this prompt. Do not answer shallowly. Do not skip sections. Do not hand-wave. Every claim must be supported by (a) explicit reasoning, (b) a concrete mechanism, or (c) a verification task.

============================
0) CRITICAL OUTPUT RULES
============================
- Output MUST follow the EXACT section order and headings specified in "STRICT FORMAT" below.
- No filler. No generic advice. No "it depends" without resolving it into decisions, assumptions, and validation plans.
- "Show your work" for every major design choice using the Decision Ledger format.
- You MUST make decisions. When uncertain, label as ASSUMPTION and include a verification checklist item.
- Evidence standard:
  - If you have browsing/citations: provide citations/links for eBay API docs/policies, limits, and any factual claims.
  - If you do NOT have browsing: explicitly mark NEEDS VERIFICATION + add to Research & Verification Plan.
- Completeness gate: You MUST end with a Build Readiness Checklist where items are DONE / PARTIAL / TODO. You may mark DONE only if you included the concrete artifact in your output (e.g., schema shown, routes listed, pseudocode provided).

=========================================
1) INPUTS YOU MAY RECEIVE (OPTIONAL)
=========================================
If the user did not provide these inputs, do NOT ask more than 7 questions total. Proceed with explicit assumptions.

Possible inputs:
- Seller profile (region/marketplace, category focus, brand/MAP constraints)
- SKU count / catalog size, listing types used (fixed-price vs auctions), variation usage
- Cost data availability (COGS granularity), shipping cost model, returns rate
- Pricing goals (maximize margin vs velocity vs sell-through targets)
- Risk tolerance and human-approval requirements
- Tech constraints (cloud preference, budget constraints, existing stack)

======================================
2) MISSION AND NON-NEGOTIABLE GOALS
======================================
Design an agentic repricing system for eBay that:
- Maximizes long-term profit AND sell-through while preventing destructive price competition ("race to the bottom").
- Learns over time from outcomes and adapts per SKU/category.
- Operates safely with constraints, auditability, and human controls.
- Is production-grade: resilient, testable, observable, secure, compliant.
- Is deeply integrated with the eBay API and eBay's policies.

=========================================
3) REQUIRED SYSTEM PROPERTIES (INVARIANTS)
=========================================
You MUST define and enforce system invariants (at least 12) such as:
- Never price below true floor (cost + fees + shipping + minimum margin). The system will need to be capable of managing multiple sellers selling the same item. It will need to be able to reprice without causing a race to the bottom.
- The tool will need to be able to operate ith little to no human intervention. This means there must be strict guardrails in place to prevent destructive behavior.
- Never reprice during low-confidence market signals (circuit breaker).
- Never use irrelevant competitors (condition/shipping/returns mismatch).
(You must provide your full list and how each is enforced + monitored.)
- The tool will need to be able to find and track competitors in real time and store them in a graph based database for similarity search. We will need to respond to price movements from competitors intuitively.

===================================================
4) QUALITY ENFORCEMENT MECHANISMS (MANDATORY)
===================================================
You MUST include:
A) Decision Ledger (for EVERY major design choice)
Use this exact template for each entry:
- Decision:
- Options Considered (at least 3):
- Selected Option:
- Why Selected (reasoning, constraints, expected impact):
- Why Not Others (specific drawbacks/tradeoffs):
- Risks Introduced:
- Mitigations:
- How We'll Know It's Working (metrics/alerts/tests + thresholds where possible):

B) Tradeoff Matrices (at least 3)
Provide at least three matrices scoring options (1–5) across:
correctness, safety, complexity, cost, maintainability, latency, scalability, compliance risk.
Required matrices:
1) Rules-first vs ML-first vs hybrid
2) Batch repricing vs streaming/near-real-time vs hybrid
3) Single-agent vs multi-agent vs modular pipeline

C) Failure-First Design
For EVERY subsystem, list:
- Top failure modes
- Blast radius
- Detection signals (metrics/logs/alerts)
- Automatic recovery
- Manual runbook action
- Data integrity safeguards (idempotency, dedupe, reconciliation)

D) Completeness Gate
End with Build Readiness Checklist (DONE/PARTIAL/TODO) with evidence pointers to sections.

==========================================================
5) DOMAIN SCOPE YOU MUST COVER (NO EXCEPTIONS)
==========================================================
You MUST design each area in depth, with reasoning and concrete implementation detail:

A) Product & UX
- Onboarding, eBay connection, catalog import, cost setup, shipping setup
- Strategy assignment (bulk + per SKU/category), approvals, audit trail
- Dashboards, alerts, experiments
- "Explain this price" and "What changed?" narratives
- Multi-tenant SaaS, roles/permissions, safe defaults
- Beautiful and intuitive UX / UI that feels natural to use and navigate for ebay sellers. Draw design inspiration from ebay's own UI.

B) System Architecture
- Components, responsibilities, interfaces, data flows
- Deployment topology, queueing/scheduling, idempotency, retries
- Clear separation: ingest → normalize → decide → risk-check → execute → learn → monitor

C) Integrations (eBay)
- Auth/token lifecycle, endpoints usage patterns, pagination, backoff
- Webhooks/events if feasible; otherwise polling strategy with SLAs
- Listing types: fixed-price vs auctions (differences must be explicit)
- Variations, multi-quantity, promotions, shipping profiles

D) Data Model
- Relational schema + event log + time-series market observations
- Entities: SKU/listing, inventory, costs, fees, shipping, competitor offers,
  decisions, executions, outcomes, experiments

E) Pricing Decisioning Engine
- Strategy library (premium/match/beat/velocity/clearance) with constraints
- Landed-price normalization (price + shipping; tax handling policy must be stated)
- Competitor set curation (condition, shipping speed, returns, seller rating thresholds)
- Outlier detection and anomaly handling
- Intellegent AI pricing engine that can respond to price movements from competitors intuitively.

F) Safeguards & Anti-Race-to-the-Bottom Controls (extremely detailed)
- Floors/ceilings, stability bands, cooldowns, minimum deltas, volatility circuit breakers
- Spiral detection: repeated undercut loops; competitor manipulation
- Confidence scoring of signals; freeze logic when confidence drops
- Human approval for high-impact changes; category-level lockdown modes

G) Learning & Optimization
- MVP rules engine first, then phased learning
- Exploration/exploitation with strict safety constraints
- Models to consider: contextual bandits, hierarchical Bayes, elasticity estimation,
  demand/velocity forecasting
- Cold start, drift detection, rollback, model monitoring, bias control

H) Evaluation & Testing
- Offline backtesting, simulation, counterfactual caveats + bias reduction
- Online experiments: A/B, switchback, sequential testing; guardrails; kill switches
- Unit/integration/load/chaos testing; sandbox strategy

I) Security, Compliance, and Governance
- Secrets, encryption, RBAC, immutable audit logs, data retention
- Policy compliance and prohibited behaviors avoidance (explicitly discuss)

J) Operations & Observability
- Logs/metrics/traces, dashboards, SLOs, alerting, incident runbooks
- Cost controls and scaling plan

===========================================================
6) MANDATED "DEEP REASONING" OUTPUTS (NON-OPTIONAL)
===========================================================
You MUST include:
1) First-principles objectives:
- Define objective function(s) and constraints mathematically where possible.
- Explain why these objectives align with business outcomes + marketplace realities.

2) System invariants:
- At least 12, each with enforcement mechanism + monitoring.

3) Algorithmic justification:
For each major algorithm (competitor set selection, outlier removal, strategy selection, exploration):
- Pseudocode
- Rationale
- Complexity/performance considerations
- Failure analysis + mitigations

4) Concrete worked examples:
- At least 5 example SKUs across different categories, costs, inventory levels,
  shipping, and competitor landscapes.
- For each: step-by-step repricing decision, showing safeguards and a Decision Ledger entry.

5) Edge case battery:
- At least 25 edge cases grouped by area (API, pricing, data, UX, learning, ops),
  and how the system handles each.

6) "Why this over alternatives":
- Architecture, data store, job scheduling, and learning approach must each include explicit alternatives and why rejected.

===========================================================
7) STRICT FORMAT (YOU MUST OUTPUT IN THIS EXACT ORDER)
===========================================================

1. Assumptions and Non-Assumptions
- List assumptions (clearly labeled ASSUMPTION).
- List what is explicitly NOT assumed.
- If key info is missing, ask at most 7 clarifying questions total; then proceed with assumptions.

2. Research and Verification Plan
- Checklist of what to verify in eBay docs/policies and how findings affect design.
- If browsing is available: include citations/links for each verified claim.
- If not: mark NEEDS VERIFICATION + provide exact doc titles/keywords to look for.

3. Objectives, Constraints, and Invariants
- Objective functions (math where possible) + constraints.
- 12+ invariants, each with enforcement + monitoring.

4. Architecture Blueprint (Text Diagram + Components)
- Text-based architecture diagram.
- Component list with responsibilities, interfaces, data flows.
- Deployment topology (cloud services/components), queue/scheduler design.
- Include failure-first overview per component.

5. Data Model and Schemas
- Relational tables/entities with key fields, keys, indexes, and retention policies.
- Event log schema (append-only) and decision/audit schema.
- Time-series market observation schema.
- Include example records for critical tables.

6. Agentic System Design
- Agents/modules, tools, permissions (least privilege), planning loop:
  observe → propose → evaluate → approve → execute → monitor → learn.
- Escalation paths and human-in-the-loop points.
- Failure recovery behaviors per agent/module.

7. Pricing Engine Design
- Strategy library definitions and when each applies.
- Decision pipeline (inputs → normalization → competitor selection → scoring → candidate price → safeguards → approval → execution).
- Pseudocode + decision tables.
- Outlier detection + confidence scoring design.

8. Safeguards and Anti-Price-War Controls
- Floors/ceilings (how computed), stability bands, cooldowns, min/max deltas.
- Spiral detection logic (define signals and thresholds).
- Volatility circuit breakers + freeze/unfreeze policy.
- Approval policies and override rules.
- Provide explicit rules with numeric defaults (labeled DEFAULT) and rationale; include how to tune safely.

9. Learning and Optimization Plan
- Phased plan: MVP rules → bandits → elasticity → forecasting (or justify different).
- Training data sources, feature sets, labeling/outcomes, drift detection.
- Exploration/exploitation policy with hard safety constraints.
- Rollback plan and model monitoring metrics/thresholds.

10. Execution and Integration Plan (eBay)
- Auth/token lifecycle, endpoint usage, batching strategy, rate limits strategy.
- Idempotency, retries, reconciliation jobs, partial outage handling.
- Webhooks/events vs polling: decision + why.
- Auction vs fixed-price handling.
- Provide API interaction pseudocode and a job schedule (cron/event-driven).

11. Evaluation, Backtesting, and Experimentation
- Offline backtest design + simulation approach; counterfactual limitations + mitigation.
- Online experiment plan: A/B, switchback, sequential testing; guardrails; kill switch.
- Define success metrics, minimum detectable effect assumptions, and stopping rules.

12. UX and Workflow Specification
- Screens/pages (list and describe), workflows, settings, permissions.
- "Explain this price" and audit trail UX (what users see and why).
- Bulk actions and safe defaults.
- Alerting UX (what triggers alerts, severity levels, actions).

13. Security, Compliance, and Governance
- RBAC model, tenant isolation, secrets management, encryption.
- Immutable audit logs and retention.
- Compliance risks and mitigations (explicitly address marketplace policy boundaries).
- Data privacy considerations and deletion/export workflows.

14. Operations, Monitoring, and Incident Response
- Observability plan: logs/metrics/traces; dashboards; SLOs; alert thresholds.
- Incident runbooks (top incidents).
- Cost controls, scaling plan, DR/backups, reconciliation.

15. Implementation Roadmap and Acceptance Criteria
- Milestones: MVP → Beta → Production → Learning/Optimization.
- For each phase: deliverables + acceptance criteria + test gates.
- Explicit go/no-go checklist.

16. Decision Ledger (Complete)
- Provide Decision Ledger entries for all major choices across product, architecture, data, algorithms, safeguards, learning, evaluation, security, ops.
- Each entry must use the required template and include "how we'll know it's working".

17. Build Readiness Checklist
- Checklist items grouped by domain.
- Each item marked DONE/PARTIAL/TODO.
- Evidence pointers to sections for DONE items.

===========================
8) STYLE CONSTRAINTS
===========================
- No generic statements; every claim requires reasoning, mechanism, or verification task.
- Use explicit numbers, thresholds, and policies. If uncertain: label ASSUMPTION and propose validation.
- Include pseudocode where decisions are made.
- Prefer safety, explainability, and operational robustness over fragile complexity.

===========================
9) NOW DO THE TASK
===========================
Produce the full end-to-end design for the agentic AI eBay repricing application, obeying ALL requirements above and using the STRICT FORMAT headings in the exact order.
  </builder_prompt>

  <technology_stack>
    <frontend>
      <framework>React with TypeScript and Vite</framework>
      <styling>Tailwind CSS</styling>
      <state_management>Zustand for global state</state_management>
      <charts>Recharts for analytics dashboards</charts>
      <port>5173</port>
    </frontend>
    <backend>
      <runtime>Node.js with Express</runtime>
      <database>PostgreSQL for relational data, TimescaleDB for time-series, neo4j graph database for similarity search</database>
      <queue>Redis + BullMQ for job scheduling</queue>
      <cache>Redis for caching</cache>
    </backend>
    <integrations>
      <ebay>eBay Browse API, Inventory API, Pricing API</ebay>
      <auth>OAuth 2.0 with refresh token management</auth>
    </integrations>
  </technology_stack>

  <success_criteria>
    <functionality>
      - eBay OAuth connection and token refresh working
      - Catalog import and sync operational
      - Repricing engine executing within safeguards
      - All 12+ invariants enforced and monitored
      - Decision audit trail complete
    </functionality>
    <safety>
      - Never prices below floor
      - Race-to-bottom detection active
      - Human approval for high-impact changes
      - Circuit breakers functional
    </safety>
    <observability>
      - All dashboards implemented
      - SLOs defined and monitored
      - Alerting pipeline active
    </observability>
  </success_criteria>
</project_specification>
